steps:
  - name: gradle:6.8-jdk11
    entrypoint: gradle
    args: [ 'bootJar' ]

  - name: gcr.io/cloud-builders/docker
    args: [ 'build', '--build-arg', 'COMMIT_SHA_ARG=$SHORT_SHA', '-t', 'gcr.io/$PROJECT_ID/tilly:latest', '.' ]

  - name: gcr.io/cloud-builders/gcloud
    args: [ compute, instances, reset, '${_INSTANCE_NAME}', '--zone=${_INSTANCE_ZONE}']

images: [ 'gcr.io/$PROJECT_ID/tilly:latest' ]

timeout: 3600s
