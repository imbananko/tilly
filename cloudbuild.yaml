steps:
  - name: gradle:6.8-jdk11
    entrypoint: gradle
    args: [ 'bootJar' ]

  - name: gcr.io/cloud-builders/docker
    args: [ 'build', '-t', 'gcr.io/$PROJECT_ID/tilly:latest', '.' ]

  - name: gcr.io/cloud-builders/gcloud
    args: [ 'compute', 'deploy', '${_INSTANCE_NAME}', '--image', 'gcr.io/$PROJECT_ID/tilly:latest', '--region', '${_INSTANCE_ZONE}' ]

images: [ 'gcr.io/$PROJECT_ID/tilly:latest' ]

timeout: 3600s
